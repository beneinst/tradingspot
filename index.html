<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Attivi Portfolio</title>
    <link rel="icon" type="image/png" href="favicon.png"> 
    <link rel="stylesheet" href="css/trade.css">
	<link rel="stylesheet" href="css/panoramica.css">
    <link rel="stylesheet" href="css/menusotto.css">
	<link rel="stylesheet" href="css/style.css">
	<style>
	/* Input Section */
.input-section {
    background: linear-gradient(135deg, rgba(58, 58, 58, 0.15) 0%, rgba(96, 96, 96, 0.2) 100%);
    border: 1px solid var(--color-border);
    border-top: 3px solid var(--color-primary);
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 5px 30px rgba(0,0,0,0.5);
    margin-bottom: 20px;
}

.input-section h2 {
    color: #F2BB66;
    margin-bottom: 20px;
    font-size: 1.4em;
    font-weight: 500;
    border-bottom: 2px solid var(--color-border);
    padding-bottom: 10px;
}

.input-group { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; }
.input-field { flex: 1; min-width: 200px; }
.input-field label { display: block; color: #F2BB66; margin-bottom: 8px; font-weight: 500; font-size: 0.95em; }
.input-field input, .input-field select {
    width: 100%; padding: 12px 15px; border: 1px solid var(--color-border); border-radius: 6px;
    background: rgba(35, 35, 59, 0.4); color: var(--color-text); font-size: 1em; transition: all 0.3s ease;
}
.input-field input:focus, .input-field select:focus {
    outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
    background: rgba(35, 35, 59, 0.6);
}
.input-field label[for="crypto-symbol"] {
    margin-top: 5px;
    display: block;
}

</style>
</head>
<body>
<div style="padding: 4px;"></div>
<div class="container">
<!-- Titolo a sinistra, sottotitolo a destra -->

<div class="container-f" style="display:flex; align-items:center; justify-content:space-between; padding:4px 0;">
  <h1 style="margin:0; font-size:1.75rem; line-height:1.8;">ðŸ”¥ Trade Attivi</h1>

  <div style="font-size:0.9rem; line-height:1.3; color:#fff; text-align:right; padding-right: 10px;">
    <em>*Gestione <strong>Trade</strong> Singoli con Accumulo e Prezzo Medio.</em>
  </div>
</div>

</div>
<div style="padding: 4px;"></div> 
<div class="container">

 <div class="container" style="padding-top: 12px; padding-bottom: 12px;">
 <!-- BLOCCO MENU -->
  <div class="iflow-body">
    <nav class="iflow-custom-menu">
      <ul>
        <li>
          <div class="iflow-menu-label">Trade</div>
          <ul>
            <li><a href="https://beneinst.github.io/tradingspot/">Trade attivi</a></li>
			<li><a href="https://beneinst.github.io/tradingspot/operativita.html">OperativitÃ </a></li>
			<li><a href="https://beneinst.github.io/tradingspot/analisi.html">Analisi</a></li>
          </ul>
        </li>
		 
        <li>
          <div class="iflow-menu-label">Capitale</div>
          <ul>
           
			<li><a href="https://beneinst.github.io/tradingspot/flowchart.html">Panoramica</a></li>
			<li><a href="https://beneinst.github.io/tradingspot/fiscoit.html">Fisco</a></li>
			<li><a href="https://beneinst.github.io/tradingspot/staking.html">Figment</a></li>
			<li><a href="https://beneinst.github.io/tradingspot/staking2.html">Ledger</a></li>
			
          </ul>
        </li>
       
        <li>
          <div class="iflow-menu-label">Strategia</div>
          <ul>
		  <li><a href="https://beneinst.github.io/tradingspot/blocco-note.html">Blocco Note</a></li>
		  <li><a href="https://beneinst.github.io/tradingspot/regole-trading.html">Regole</a></li>
            <li><a href="https://beneinst.github.io/tradingspot/Strategia-Trading.html">Indicatore 4H</a></li>
           
          </ul>
        </li>
       
		<li>
          <div class="iflow-menu-label">Backup</div>
          <ul>
            <li><a href="https://beneinst.github.io/tradingspot/backup.html">Backup</a></li>
          </ul>
        </li>
		
      </ul>
    </nav>
  </div>
  </div>       
   <div style="padding: 4px;"></div>             
      
  <div class="container">

  <form id="trade-form" class="container-f">
    <h2>ðŸ’± Aggiungi Entry al Trade</h2>

    <div class="input-group input-group-row">
      <div class="input-field">
        <label for="crypto-symbol">Simbolo cripto</label>
        <input type="text" id="crypto-symbol" placeholder="BTC" required>
      </div>

      <div class="input-field">
        <label for="trade-quantity">QuantitÃ </label>
        <input type="number"
               id="trade-quantity"
               step="0.00000001"
               placeholder="0.00000000"
               required>
      </div>

      <div class="input-field">
        <label for="invested-amount">Importo entry (USDC)</label>
        <input type="number"
               id="invested-amount"
               step="0.01"
               placeholder="100.00"
               required>
      </div>
    </div>

    <div class="input-actions">
      <button type="submit" class="btn btn-primary">
        âž• Aggiungi Entry
      </button>
    </div>
  </form>

</div>



    </div>

</div>
</div> <div style="padding: 4px;"></div>
        <div class="container">
            <h4 class="section-title" style="color: #ffe4b5 !important;">ðŸŽ¯ I tuoi Trade Attivi</h4>
            <div id="trades-container"></div>
        </div>
		
		
		<div id="trade-counter" style="display: none;">
  ðŸ“Š Trade attivi: <span id="trade-count" style="display: inline;">0</span>
</div>
<div style="padding: 5px;"></div>		
<div class="container">
  <h5 class="section-title" style="color: #ffe4b5 !important;">ðŸª” Storico Distribuzione Capitale</h5>
  
 

  <!-- CONTENITORE FLEX PRINCIPALE (Due Colonne) -->
  <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">

    <!-- COLONNA 1: STATISTICHE (Sinistra) -->
    <div style="flex: 0 0 40%; display: flex; gap: 10px; min-width: 300px;">
      
      <!-- Statistica 1 -->
      <div class="ts-stat-item" style="flex: 1;">
        <div class="ts-stat-label">Totale in Cripto</div>
        <div class="ts-stat-value ts-text-total" id="totaleIn">0</div>
      </div>

      <!-- Statistica 2 -->
      <div class="ts-stat-item" style="flex: 1;">
        <div class="ts-stat-label">Restanti in Dollari</div>
        <div class="ts-stat-value ts-text-capital" id="capitale">30</div>
      </div>

    </div>

    <!-- COLONNA 2: GRAFICO (Destra) -->
    <div style="flex: 1; min-width: 300px;">
      <!-- Box Grafico con altezza ridotta a 150px per la barra orizzontale -->
      <div class="ts-chart-box" style="height: 150px; padding: 10px; position: relative; width: 100%;">
        <canvas id="capitaleChart" style="width: 100%; height: 100%; display: block;"></canvas>
      </div>
    </div>

  </div>

</div>


<div style="padding: 4px;"></div>
  
  
  <!-- Nuova card per il grafico storico -->
 <div class="container">
   <div class="ts-dash-card">
  
  <!-- Intestazione Tabs -->
  <div class="ts-tab-header">
    <button class="btn-edit active" onclick="openTsTab(event, 'tab-distribuzione')">Distribuzione nel Tempo</button>
    <button class="btn-edit" onclick="openTsTab(event, 'tab-percentuale')">Analisi Percentuale</button>
  </div>

  <!-- CONTENUTO TAB 1: DISTRIBUZIONE -->
  <div id="tab-distribuzione" class="ts-tab-content active">
    
    <!-- Box Grafico Grande (600px) -->
    <div class="ts-chart-box-large" style="position: relative; width: 100%;">
      <canvas id="storicoCapitaleChart" style="width: 100%; height: 100%;"></canvas>
    </div>

    <!-- Selettore Tempo -->
    <div class="ts-time-selector" style="margin-top: 25px;">
      <button class="btn-edit active" data-days="30" onclick="cambiaRangeTempo(this)">30 Giorni</button>
      <button class="btn-edit" data-days="90" onclick="cambiaRangeTempo(this)">90 Giorni</button>
      <button class="btn-edit" data-days="180" onclick="cambiaRangeTempo(this)">6 Mesi</button>
      <button class="btn-edit" data-days="365" onclick="cambiaRangeTempo(this)">1 Anno</button>
      <button class="btn-edit" data-days="all" onclick="cambiaRangeTempo(this)">Tutto</button>
      
      <!-- Pulsante Scarica -->
      <button class="btn-edit" onclick="scaricaGrafico()" style="margin-left: 15px;">
        ðŸ“· Scarica Grafico
      </button>
    </div>
  </div>

  <!-- CONTENUTO TAB 2: PERCENTUALE -->
  <div id="tab-percentuale" class="ts-tab-content" style="display: none;">
    
    <div class="ts-info-box">
      Analisi del tempo in cui il capitale Ã¨ stato allocato nelle seguenti percentuali in dollari.
    </div>

    <!-- Box Grafico Grande -->
    <div class="ts-chart-box-large" style="position: relative; width: 100%;">
      <canvas id="percentualeCapitaleChart" style="width: 100%; height: 100%;"></canvas>
    </div>

    <!-- Griglia Statistiche Percentuali -->
    <div class="ts-stats-grid" style="margin-top: 30px;">
      
      <div class="ts-grid-item">
        <div class="ts-stat-label">0-25% in Dollari</div>
        <div class="ts-stat-value" style="color: #3BB9FF;" id="percentuale0_25">0 giorni</div>
      </div>
      
      <div class="ts-grid-item">
        <div class="ts-stat-label">25-50% in Dollari</div>
        <div class="ts-stat-value" style="color: #3BB9FF;" id="percentuale25_50">0 giorni</div>
      </div>
      
      <div class="ts-grid-item">
        <div class="ts-stat-label">50-75% in Dollari</div>
        <div class="ts-stat-value" style="color: #3BB9FF;" id="percentuale50_75">0 giorni</div>
      </div>
      
      <div class="ts-grid-item">
        <div class="ts-stat-label">75-100% in Dollari</div>
        <div class="ts-stat-value" style="color: #3BB9FF;" id="percentuale75_100">0 giorni</div>
      </div>

    </div>

    <!-- Pulsante Download -->
    <div style="text-align: center; margin-top: 20px; margin-bottom: 20px;">
        <button onclick="scaricaGraficoPercentuale1()" class="btn-edit">
          <i class="fas fa-download"></i> Scarica Grafico Percentuale
        </button>
    </div>

  </div>

</div>

<!-- Elemento di servizio nascosto (o visibile se serve debug) -->
<div style="display:none;" id="infoTotaleTrade"></div>
    
    
        </div>
      </div>
    </div>
</div>
<span id="infoTotaleTrade"></span></div></div>
<div style="padding: 2px;"></div>
</div>


		
		
     
		
		
	<!-- FOOTER -->

<div style="padding: 4px;"></div>  

<div class="container">
  <div class="container-f" style="padding-top: 1px; padding-bottom: 1px;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      
      <img src="images/logoinvest2a3.svg"
           alt="FlowChart"
           style="height: 50px; width: auto; margin-right: 16px;" />
		   <p style="margin: 0; color: #c3c3c3; text-align: left; height: 10px; line-height: 12px;">
        Â© 2025 by Gerardo D
      </p>
    </div></div>



<div style="display:none;">
  <div id="totaleIn"></div>
  <div id="capitale"></div>
  <div id="totaleTrade"></div>
  <div id="infoTotaleTrade"></div>
  <input id="quotaPerTrade" type="number">
  <input id="inputTotaleIn" type="number">
  <div id="capitaleTotale"></div>
  <div id="capitaleInDollari"></div>
  <div id="totaleInDollari"></div>
  <span id="mediaTradeTotaleIn"></span>
  <span id="mediaDollariTrading"></span>
  <canvas id="capitaleChart"></canvas>
  <canvas id="storicoCapitaleChart"></canvas>
  <canvas id="percentualeCapitaleChart"></canvas>
</div>

<!-- Bottone torna sopra principale (con freccia CSS) -->
    <button class="back-to-top" id="backToTop" title="Torna in cima"></button>  
    
    <script>
        // Funzione per mostrare/nascondere il bottone
        function toggleBackToTopButton() {
            const backToTop = document.getElementById('backToTop');
            const backToTopAlt = document.getElementById('backToTopAlt');
            
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
                backToTopAlt.classList.add('show');
            } else {
                backToTop.classList.remove('show');
                backToTopAlt.classList.remove('show');
            }
        }
        
        // Funzione per tornare in cima con animazione smooth
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Event listeners
        window.addEventListener('scroll', toggleBackToTopButton);
        
        document.getElementById('backToTop').addEventListener('click', scrollToTop);
        document.getElementById('backToTopAlt').addEventListener('click', scrollToTop);
        
        // Controlla subito se mostrare il bottone
        toggleBackToTopButton();
    </script>

<script src="js/trade.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.9/dist/chart.umd.min.js"></script>
<script src="js/panoramica.js"></script>
<script>
// ðŸ”„ Contatore reattivo trade attivi
function updateTradeCount() {
  const trades = JSON.parse(localStorage.getItem('singleTrades') || '[]');
  const count = trades.length;
  const span = document.getElementById('trade-count');
  if (span) span.textContent = count;
}

// ðŸ“¡ Ascolta eventi di apertura/chiusura trade
window.addEventListener('storage', (e) => {
  if (e.key === '__tradeEvent__') {
    updateTradeCount();
  }
});

// ðŸ§  Aggiorna anche al caricamento pagina
document.addEventListener('DOMContentLoaded', updateTradeCount);
</script>

<script>
// Mini versione per backup automatico dalla home
function scaricaBackupSilenzioso() {
  const blob = new Blob([JSON.stringify(localStorage, null, 2)], {
    type: 'application/json'
  });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  
  const oggi = new Date();
  const giornoSettimana = oggi.toLocaleDateString('it-IT', { weekday: 'long' });
  const dataOra = oggi.toISOString().slice(0, 19).replace(/:/g, '-');
  
  a.download = `backup-${giornoSettimana}-${dataOra}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function verificaBackupAutomatico() {
  const CHIAVE_ULTIMO_BACKUP = 'ultimoBackupAutomatico';
  const oggi = new Date().toDateString();
  const ultimoBackup = localStorage.getItem(CHIAVE_ULTIMO_BACKUP);
  
  if (ultimoBackup !== oggi) {
    console.log('ðŸ”„ Backup automatico dalla home...');
    scaricaBackupSilenzioso();
    localStorage.setItem(CHIAVE_ULTIMO_BACKUP, oggi);
    console.log('âœ… Backup completato');
  }
}

// Avvia al caricamento della home
document.addEventListener('DOMContentLoaded', verificaBackupAutomatico);
</script>

<script>
function openTsTab(evt, tabName) {
    var i, tabcontent, tablinks;

    // 1. Nascondi tutti i contenuti con classe 'ts-tab-content'
    tabcontent = document.getElementsByClassName("ts-tab-content");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // 2. Rimuovi la classe 'active' da tutti i bottoni dentro l'header dei tab
    // Nota: Usiamo querySelectorAll per prendere qualsiasi bottone dentro l'header
    tablinks = document.querySelectorAll(".ts-tab-header button");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // 3. Mostra il tab corrente
    document.getElementById(tabName).style.display = "block";
    
    // 4. Aggiungi la classe 'active' al bottone cliccato
    evt.currentTarget.className += " active";
}
</script>

</body>

</html>