<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4H Enhanced Trading Strategy - Indicatore Completo</title>
    <link rel="icon" type="image/png" href="favicon.png"> 
    <style>
     /* Global CSS */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background: linear-gradient(135deg, #121212 0%, #1e1e1e 100%);
    font-family: 'Poppins', sans-serif;
    color: #e0e0e0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

.container {
    max-width: 1300px;
    margin: 0 auto;
    flex-grow: 1;
}

/* Box Styles */
.header-box, 
.content-box,
.indicator-info-box {
    background-color: #222831;
    padding: 20px 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.7);
    margin-bottom: 20px;
    width: 100%;
    box-sizing: border-box;
}

/* Specific style for header-box */
.header-box {
    background-color: #3a5a85;
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    position: relative; /* For language selector */
}

.header-box h1 {
    color: white;
    margin: 0;
}

/* Language selector styles */
.language-selector {
    position: absolute;
    top: 10px;
    right: 20px;
    background-color: rgba(255, 255, 255, 0.15);
    border-radius: 5px;
    padding: 5px 10px;
}

.language-selector a {
    color: #ddd;
    text-decoration: none;
    font-weight: bold;
    margin: 0 5px;
    transition: color 0.3s ease;
}

.language-selector a:hover {
    color: #ffd54f;
}

/* Styles for titles inside boxes */
h2 {
    color: #80aaff;
    border-bottom: 1px solid #333;
    padding-bottom: 10px;
    margin-top: 20px;
    margin-bottom: 20px;
}

/* Table styles */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    margin-bottom: 30px;
}
th, td {
    border: 1px solid #444;
    padding: 12px;
    text-align: left;
    vertical-align: top;
    color: #ddd;
}
th {
    background-color: #2c3e50;
    color: #bbb;
    font-weight: bold;
}
tr:nth-child(even) {
    background-color: #1f2937;
}

/* Color and bold classes */
.green { color: #28a745; font-weight: bold; }
.red { color: #dc3545; font-weight: bold; }
.white { color: #bbb; font-weight: bold; }
.yellow { color: #ffc107; font-weight: bold; }
.orange { color: #fd7e14; font-weight: bold; }
.gray { color: #6c757d; font-weight: bold; }
.blue { color: #4a90e2; font-weight: bold; }
.purple { color: #9b59b6; font-weight: bold; }
.bold { font-weight: bold; }

/* Alert box styles */
.alert-box {
    padding: 15px;
    margin: 15px 0;
    border-radius: 8px;
    border-left: 4px solid;
}
.alert-success {
    background-color: #214d20;
    border-color: #28a745;
    color: #a9d18e;
}
.alert-warning {
    background-color: #4a4200;
    border-color: #ffc107;
    color: #fff3cd;
}
.alert-danger {
    background-color: #4a1a1f;
    border-color: #dc3545;
    color: #f5a9ac;
}

/* Indicator info box style */
.indicator-info-box {
    text-align: center;
    padding: 30px;
    margin-top: 20px;
}
.indicator-info-box p {
    margin-bottom: 15px;
    font-size: 1.1em;
    color: #ccc;
}
.indicator-info-box a.profile-link {
    color: #80aaff;
    text-decoration: none;
    font-weight: bold;
    font-size: 1.1em;
    display: block;
    margin-bottom: 20px;
    transition: color 0.3s ease;
}
.indicator-info-box a.profile-link:hover {
    color: #5588cc;
}
.indicator-button {
    display: inline-block;
    background-color: #28a745;
    color: white;
    padding: 15px 30px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 1.2em;
    font-weight: bold;
    transition: background-color 0.3s ease, transform 0.2s ease;
}
.indicator-button:hover {
    background-color: #218838;
    transform: translateY(-2px);
}

/* Footer style */
.footer {
    margin-top: 30px;
    margin-bottom: 10px;
    text-align: center;
    font-size: 16px;
    color: #f2bb66;
    font-weight: normal;
}

.footer a {
    color: #ffe;
    text-decoration: none;
    margin: 0 8px;
    transition: color 0.3s ease;
}

.footer a:hover {
    color: #ffdb58;
}

/* Additional styles for content structure */
h3 {
    color: #80aaff;
    margin-top: 15px;
    margin-bottom: 10px;
}

.signal-buy { color: #28a745; }
.signal-sell { color: #dc3545; }

ul {
    margin-left: 20px;
    margin-bottom: 15px;
}

li {
    margin-bottom: 8px;
    line-height: 1.4;
}

p {
    margin-bottom: 15px;
    line-height: 1.5;
}

.note {
    color: #aaa;
    font-style: italic;
    font-size: 0.95em;
}

    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <div class="language-selector">
            <a href="Strategia-Trading.html">ITA</a> | <a href="Strategia-Trading2.html" class="bold">ENG</a>
        </div>
        <h1>📊 STRATEGIA MULTI-CONFLUENCE VER. 9</h1>
        <p class="note">Sistema di Trading Avanzato 4H / 1H con 6 Categorie di Indicatori e Regressione Lineare</p>
    </div>

    <div class="content-box">
        <h2>🚀 PANORAMICA SISTEMA MULTI-CONFLUENCE</h2>
        
        <h3>Sistema Avanzato con Filtro Primario</h3>
        <ul>
            <li><b>Regressione Lineare (Filtro Primario):</b> Determina la direzione principale del trend con lunghezza 50 e sensibilità 0.8. Fornisce il segnale di base e deve essere sempre attivato per generare operazioni valide.</li>
            <li><b>Bande di Bollinger:</b> Identifica condizioni di ipercomprato/ipervenduto con periodo 20 e deviazione standard 2.0. Contribuisce alla confluenza quando il prezzo è in zone estreme.</li>
            <li><b>Stochastic RSI:</b> Misura momentum e identifica punti di inversione con parametri RSI 14, Stoch 14, Smoothing K=3, D=3. Attivo in zone di ipervenduto (≤20) e ipercomprato (≥80).</li>
            <li><b>Medie Mobili e Trend:</b> Combina EMA 21, SMA 50 e RSI 14 per determinare il trend generale e la forza del momentum.</li>
            <li><b>Indicatori Momentum (Nuovo):</b> Sistema a 4 componenti che include Momentum, ROC, Williams %R e CCI per valutare la forza complessiva del movimento.</li>
            <li><b>Price Action Patterns (Nuovo):</b> Riconosce pattern candlestick come Engulfing, Hammer, Shooting Star e Doji, validati tramite ATR per garantire significatività statistica.</li>
        </ul>
        
        <h3>Sistema di Confluence Scoring</h3>
        <p class="note">Il sistema calcola un punteggio di confluenza da -6 a +6 sommando i contributi di tutti gli indicatori:</p>
        <ul>
            <li><b>Confluence Score = BB + Pivot + Stoch RSI + Medie Mobili + Momentum + Price Action</b></li>
            <li><b>Range Operativo:</b> Tipicamente da -4 a +4 con segnali validi quando ≥ +1 (buy) o ≤ -1 (sell)</li>
            <li><b>Validazione Pearson R:</b> Richiede |R| ≥ 0.5 per garantire correlazione statisticamente significativa</li>
        </ul>
    </div>

    <div class="content-box">
        <h2>📋 REGOLE DI TRADING MULTI-CONFLUENCE</h2>

        <h3 class="signal-buy">🟢 SEGNALE DI ACQUISTO (BUY)</h3>
        <p class="note">Identifica opportunità di acquisto con confluenza multipla in zone di ipervenduto</p>
        <ul>
            <li><b>Condizioni Obbligatorie (TUTTE devono essere soddisfatte):</b>
                <ul>
                    <li><b>Regressione Lineare ≤ -0.8:</b> Posizione normalizzata in zona di ipervenduto estremo</li>
                    <li><b>Confluence Score ≥ +1.0:</b> Almeno una confluenza positiva netta da indicatori secondari</li>
                    <li><b>Pearson R |R| ≥ 0.5:</b> Correlazione statisticamente significativa per validare il trend</li>
                </ul>
            </li>
            <li><b>Confluenze Positive (+1 punto ciascuna):</b>
                <ul>
                    <li><b>Bollinger Bands ≤ -0.7:</b> Prezzo in zona ipervenduto delle bande</li>
                    <li><b>Stochastic RSI ≤ 20:</b> Momentum in zona di ipervenduto</li>
                    <li><b>Pivot Points:</b> Prezzo entro 3% da supporto pivot</li>
                    <li><b>Momentum Rialzista:</b> Tutti e 4 gli indicatori momentum positivi</li>
                    <li><b>Price Action Bullish:</b> Pattern rialzisti (Engulfing, Hammer) validati da ATR</li>
                    <li><b>Trend Rialzista:</b> EMA21 > SMA50 + Close > EMA21 + RSI > 50</li>
                </ul>
            </li>
        </ul>

        <h3 class="signal-sell">🔴 SEGNALE DI VENDITA (SELL)</h3>
        <p class="note">Identifica opportunità di vendita con confluenza multipla in zone di ipercomprato</p>
        <ul>
            <li><b>Condizioni Obbligatorie (TUTTE devono essere soddisfatte):</b>
                <ul>
                    <li><b>Regressione Lineare ≥ +0.8:</b> Posizione normalizzata in zona di ipercomprato estremo</li>
                    <li><b>Confluence Score ≤ -1.0:</b> Almeno una confluenza negativa netta da indicatori secondari</li>
                    <li><b>Pearson R |R| ≥ 0.5:</b> Correlazione statisticamente significativa per validare il trend</li>
                </ul>
            </li>
            <li><b>Confluenze Negative (-1 punto ciascuna):</b>
                <ul>
                    <li><b>Bollinger Bands ≥ +0.7:</b> Prezzo in zona ipercomprato delle bande</li>
                    <li><b>Stochastic RSI ≥ 80:</b> Momentum in zona di ipercomprato</li>
                    <li><b>Pivot Points:</b> Prezzo entro 3% da resistenza pivot</li>
                    <li><b>Momentum Ribassista:</b> Tutti e 4 gli indicatori momentum negativi</li>
                    <li><b>Price Action Bearish:</b> Pattern ribassisti (Engulfing, Shooting Star) validati da ATR</li>
                    <li><b>Trend Ribassista:</b> EMA21 < SMA50 + Close < EMA21 + RSI < 50</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="content-box">
        <h2>🧩 COMPONENTI E DESCRIZIONE FUNZIONALE</h2>
        <table>
            <tr>
                <th>Indicatore</th>
                <th>Funzione Principale</th>
                <th>Parametri e Calcolo</th>
                <th>Contributo Confluence</th>
            </tr>
            <tr>
                <td><b>Regressione Lineare</b></td>
                <td>Filtro primario per trend e segnali base</td>
                <td>Lunghezza 50, Sensibilità 0.8, Posizione normalizzata -1 a +1</td>
                <td>Filtro obbligatorio, non punteggio</td>
            </tr>
            <tr>
                <td><b>Bande di Bollinger</b></td>
                <td>Identifica volatilità e condizioni estreme</td>
                <td>Periodo 20, Deviazione 2.0, Posizione normalizzata -1 a +1</td>
                <td>+1 se ≤-0.7, -1 se ≥+0.7</td>
            </tr>
            <tr>
                <td><b>Stochastic RSI</b></td>
                <td>Misura momentum e punti di inversione</td>
                <td>RSI 14, Stoch 14, K=3, D=3, Soglie 20/80</td>
                <td>+1 se ≤20, -1 se ≥80</td>
            </tr>
            <tr>
                <td><b>Indicatori Momentum</b></td>
                <td>Valuta forza del movimento (4 componenti)</td>
                <td>Momentum(10), ROC(12), Williams%R(14), CCI(20)</td>
                <td>+1 se tutti positivi, -1 se tutti negativi</td>
            </tr>
            <tr>
                <td><b>Price Action Patterns</b></td>
                <td>Riconosce pattern candlestick significativi</td>
                <td>Engulfing, Hammer, Shooting Star, Doji + ATR(14) validation</td>
                <td>+1 pattern rialzista, -1 pattern ribassista</td>
            </tr>
            <tr>
                <td><b>Punti Pivot</b></td>
                <td>Identifica supporti e resistenze dinamici</td>
                <td>Lookback 25 periodi, Distanza 3%</td>
                <td>+1 vicino supporto, -1 vicino resistenza</td>
            </tr>
            <tr>
                <td><b>Medie Mobili</b></td>
                <td>Determina trend generale e momentum</td>
                <td>EMA 21, SMA 50, RSI 14</td>
                <td>+0.5 trend rialzista, -0.5 trend ribassista</td>
            </tr>
            <tr>
                <td><b>Pearson R</b></td>
                <td>Validazione statistica correlazione</td>
                <td>Correlazione regressione lineare, Soglia ≥0.5</td>
                <td>Filtro qualità, non punteggio</td>
            </tr>
        </table>
    </div>

    <div class="content-box">
        <h2>📊 DASHBOARD & MONITORAGGIO</h2>
        <table>
            <tr>
                <th>Indicatore Dashboard</th>
                <th>Scala / Valore</th>
                <th>Interpretazione del Colore / Stato</th>
            </tr>
            <tr>
                <td>🎯 Regressione Lineare (PRIMARY)</td>
                <td>Da -1 a +1</td>
                <td>
                    <span class="green">🟢 BUY ZONE: ≤ -0.8</span><br>
                    <span class="red">🔴 SELL ZONE: ≥ +0.8</span><br>
                    <span class="white">⚪ NEUTRAL: -0.8 &lt; x &lt; +0.8</span><br>
                    <span class="note">Filtro PRIMARIO obbligatorio</span>
                </td>
            </tr>
            <tr>
                <td>📊 Bande di Bollinger</td>
                <td>Da -1 a +1</td>
                <td>
                    <span class="green">🟢 OVERSOLD: ≤ -0.7</span><br>
                    <span class="red">🔴 OVERBOUGHT: ≥ +0.7</span><br>
                    <span class="yellow">🟡 NEUTRAL: Zona neutra</span>
                </td>
            </tr>
            <tr>
                <td>⚡ Stochastic RSI</td>
                <td>K e D (0-100)</td>
                <td>
                    <span class="green">🟢 OVERSOLD: K ≤ 20</span><br>
                    <span class="red">🔴 OVERBOUGHT: K ≥ 80</span><br>
                    <span class="yellow">🟡 NEUTRAL: 20 &lt; K &lt; 80</span>
                </td>
            </tr>
            <tr>
                <td>🚀 Indicatori Momentum</td>
                <td>Combinazione 4 componenti</td>
                <td>
                    <span class="green">🟢 BULLISH: Tutti e 4 positivi</span><br>
                    <span class="red">🔴 BEARISH: Tutti e 4 negativi</span><br>
                    <span class="yellow">🟡 MIXED: Segnali contrastanti</span>
                </td>
            </tr>
            <tr>
                <td>🕯️ Price Action Patterns</td>
                <td>Pattern Recognition + ATR</td>
                <td>
                    <span class="green">🟢 BULLISH: Engulfing Bull, Hammer</span><br>
                    <span class="red">🔴 BEARISH: Engulfing Bear, Shooting Star</span><br>
                    <span class="yellow">🟡 DOJI: Indecisione mercato</span>
                </td>
            </tr>
            <tr>
                <td>🎯 Pearson R</td>
                <td>Coefficiente di correlazione</td>
                <td>
                    <span class="green">💪 VALID TREND: |R| ≥ 0.5</span><br>
                    <span class="orange">⚠️ WEAK TREND: |R| &lt; 0.5</span>
                </td>
            </tr>
            <tr>
                <td>🔗 Confluence Score</td>
                <td>Punteggio totale (-6 a +6)</td>
                <td>
                    <span class="green">🚀 STRONG BUY: Score ≥ +3</span><br>
                    <span class="green">📈 BUY: Score ≥ +1</span><br>
                    <span class="red">📉 SELL: Score ≤ -1</span><br>
                    <span class="red">💥 STRONG SELL: Score ≤ -3</span><br>
                    <span class="gray">➖ NO SIGNAL: -1 &lt; Score &lt; +1</span>
                </td>
            </tr>
            <tr>
                <td>💪 Signal Strength</td>
                <td>Intensità combinata</td>
                <td>
                    <span class="green">🔥 MOLTO FORTE: ≥ +3</span><br>
                    <span class="green">💪 FORTE: +2</span><br>
                    <span class="yellow">📊 MODERATO: +1</span><br>
                    <span class="red">📊 MODERATO: -1</span><br>
                    <span class="red">💪 FORTE: -2</span><br>
                    <span class="red">🔥 MOLTO FORTE: ≤ -3</span>
                </td>
            </tr>
        </table>
    </div>

    <div class="content-box">
        <h2>⚙️ PARAMETRI OTTIMIZZATI MULTI-CONFLUENCE</h2>
        <table>
            <tr>
                <th>Gruppo Indicatori</th>
                <th>Parametro</th>
                <th>Valore</th>
                <th>Ragione Ottimizzazione</th>
            </tr>
            <tr>
                <td>Regressione Lineare</td>
                <td>Length</td>
                <td>50</td>
                <td>Equilibrio perfetto tra reattività e stabilità per timeframe 4H</td>
            </tr>
            <tr>
                <td>Regressione Lineare</td>
                <td>Sensitivity</td>
                <td>0.8</td>
                <td>Soglia ottimale per filtrare falsi segnali mantenendo reattività</td>
            </tr>
            <tr>
                <td>Bande di Bollinger</td>
                <td>Length / Multiplier</td>
                <td>20 / 2.0</td>
                <td>Standard statistico per catturare 95% movimenti in timeframe 4H</td>
            </tr>
            <tr>
                <td>Stochastic RSI</td>
                <td>RSI/Stoch Length</td>
                <td>14 / 14</td>
                <td>Periodo standard momentum, K=3 D=3 per smoothing ottimale</td>
            </tr>
            <tr>
                <td>Indicatori Momentum</td>
                <td>Momentum/ROC/Williams/CCI</td>
                <td>10/12/14/20</td>
                <td>Periodi differenziati per catturare multiple velocità momentum</td>
            </tr>
            <tr>
                <td>Price Action</td>
                <td>ATR Validation</td>
                <td>14 (>0.5*ATR)</td>
                <td>Filtra pattern significativi escludendo rumore di mercato</td>
            </tr>
            <tr>
                <td>Punti Pivot</td>
                <td>Lookback / Distance</td>
                <td>25 / 3%</td>
                <td>Identifica livelli significativi senza eccessivo rumore</td>
            </tr>
            <tr>
                <td>Medie Mobili</td>
                <td>EMA / SMA</td>
                <td>21 / 50</td>
                <td>Combinazione reattiva (EMA) e stabile (SMA) per trend</td>
            </tr>
            <tr>
                <td>Validazione</td>
                <td>Pearson R Threshold</td>
                <td>0.5</td>
                <td>Soglia statistica per garantire correlazione significativa</td>
            </tr>
        </table>
    </div>

    <div class="content-box">
        <h2>📚 PROCEDURA OPERATIVA MULTI-CONFLUENCE</h2>
        <table>
            <tr>
                <th>Step</th>
                <th>Azione</th>
                <th>Controlli Specifici</th>
            </tr>
            <tr>
                <td>1. Pre-Analisi</td>
                <td>Verifica Pearson R</td>
                <td>🎯 |R| deve essere ≥ 0.5 per trading valido</td>
            </tr>
            <tr>
                <td>2. Filtro Primario</td>
                <td>Controllo Regressione Lineare</td>
                <td>📊 Deve essere ≤ -0.8 (BUY) o ≥ +0.8 (SELL). OBBLIGATORIO.</td>
            </tr>
            <tr>
                <td>3. Calcolo Confluence</td>
                <td>Somma Punteggi Indicatori</td>
                <td>🔗 BB + Pivot + StochRSI + MA + Momentum + PriceAction</td>
            </tr>
            <tr>
                <td>4. Validazione Score</td>
                <td>Verifica Confluence Score</td>
                <td>✅ Deve essere ≥ +1 (BUY) o ≤ -1 (SELL)</td>
            </tr>
            <tr>
                <td>5. Controllo Intensità</td>
                <td>Calcola Signal Strength</td>
                <td>💪 Signal Strength = Confluence Score + LinReg Signal</td>
            </tr>
            <tr>
                <td>6. Analisi Pattern</td>
                <td>Verifica Price Action</td>
                <td>🕯️ Conferma con pattern candlestick validati da ATR</td>
            </tr>
            <tr>
                <td>7. Momentum Check</td>
                <td>Controllo 4 Indicatori Momentum</td>
                <td>🚀 Tutti devono allinearsi nella stessa direzione</td>
            </tr>
            <tr>
                <td>8. Segnale Finale</td>
                <td>Attendi Confluenza Completa</td>
                <td>🎯 TUTTI i criteri obbligatori devono essere soddisfatti</td>
            </tr>
            <tr>
                <td>9. Gestione Rischio</td>
                <td>Imposta Stop Loss</td>
                <td>🛡️ Sotto/sopra canale regressione + supporto/resistenza pivot</td>
            </tr>
            <tr>
                <td>10. Take Profit</td>
                <td>Strategia Uscita Graduale</td>
                <td>🎯 Livello 1: Banda opposta, Livello 2: Canale opposto, Livello 3: Pivot opposto</td>
            </tr>
        </table>
    </div>

    <div class="content-box">
        <h2>⚠️ GESTIONE RISCHIO E USCITE</h2>
        
        <div class="alert-box alert-danger">
            <h3>🚨 STOP LOSS SUGGERITI</h3>
            <ul>
                <li><b>Buy Orders:</b> Sotto il canale inferiore di regressione lineare O supporto pivot più vicino</li>
                <li><b>Sell Orders:</b> Sopra il canale superiore di regressione lineare O resistenza pivot più vicina</li>
                <li><b>Risk Management:</b> Non rischiare mai più del 1-2% del capitale per trade</li>
            </ul>
        </div>

        <div class="alert-box alert-success">
            <h3>🎯 TAKE PROFIT STRATIFICATI</h3>
            <ul>
                <li><b>Livello 1 (50% posizione):</b> Banda Bollinger opposta alla direzione trade</li>
                <li><b>Livello 2 (30% posizione):</b> Canale opposto di regressione lineare</li>
                <li><b>Livello 3 (20% posizione):</b> Pivot point opposto più vicino</li>
                <li><b>Trailing Stop:</b> Considera trailing stop dinamico basato su ATR</li>
            </ul>
        </div>

        <div class="alert-box alert-warning">
            <h3>⚠️ USCITE ANTICIPATE</h3>
            <ul>
                <li><b>Momentum Reversal:</b> Cambio direzione negli indicatori momentum (da tutti positivi a negativi)</li>
                <li><b>Confluence Score Reversal:</b> Inversione del punteggio (da positivo a negativo o viceversa)</li>
                <li><b>Pattern Contrario:</b> Formazione pattern candlestick opposti significativi</li>
                <li><b>Pearson R Deterioration:</b> Se correlazione scende sotto 0.5 durante il trade</li>
            </ul>
        </div>
    </div>

    <div class="content-box">
        <h2>🎯 ESEMPI PRATICI MULTI-CONFLUENCE</h2>
        
        <h3 class="signal-buy">Esempio BUY Signal Molto Forte (+4)</h3>
        <div class="alert-box alert-success">
            <ul>
                <li>🎯 <b>Regressione Lineare:</b> -0.85 (BUY ZONE ✓)</li>
                <li>💪 <b>Pearson R:</b> 0.75 (TREND VALIDO ✓)</li>
                <li>📊 <b>Bollinger Bands:</b> -0.8 (OVERSOLD +1)</li>
                <li>⚡ <b>Stochastic RSI:</b> 15 (OVERSOLD +1)</li>
                <li>🎯 <b>Pivot Point:</b> 2% da supporto (+1)</li>
                <li>🚀 <b>Momentum:</b> Tutti e 4 positivi (+1)</li>
                <li>🕯️ <b>Price Action:</b> Hammer validato ATR (+1)</li>
                <li>📈 <b>Trend MA:</b> EMA21>SMA50, RSI>50 (+0.5)</li>
                <li>🔗 <b>Confluence Score:</b> +5.5</li>
                <li>💪 <b>Signal Strength:</b> +4.5 (MOLTO FORTE)</li>
            </ul>
        </div>

        <h3 class="signal-sell">Esempio SELL Signal Molto Forte (-4)</h3>
        <div class="alert-box alert-danger">
            <ul>
                <li>🎯 <b>Regressione Lineare:</b> +0.90 (SELL ZONE ✓)</li>
                <li>💪 <b>Pearson R:</b> 0.82 (TREND VALIDO ✓)</li>
                <li>📊 <b>Bollinger Bands:</b> +0.85 (OVERBOUGHT -1)</li>
                <li>⚡ <b>Stochastic RSI:</b> 85 (OVERBOUGHT -1)</li>
                <li>🎯 <b>Pivot Point:</b> 1.5% da resistenza (-1)</li>
                <li>🚀 <b>Momentum:</b> Tutti e 4 negativi (-1)</li>
                <li>🕯️ <b>Price Action:</b> Shooting Star validato ATR (-1)</li>
                <li>📉 <b>Trend MA:</b> EMA21<SMA50, RSI<50 (-0.5)</li>
                <li>🔗 <b>Confluence Score:</b> -5.5</li>
                <li>💪 <b>Signal Strength:</b> -4.5 (MOLTO FORTE)</li>
            </ul>
        </div>

        <h3>❌ Esempio Segnale RIFIUTATO</h3>
        <div class="alert-box alert-warning">
            <ul>
                <li>🎯 <b>Regressione Lineare:</b> -0.85 (sembrerebbe BUY)</li>
                <li>💪 <b>Pearson R:</b> 0.35 (CORRELAZIONE DEBOLE ❌)</li>
                <li>🔗 <b>Confluence Score:</b> +0.5 (SOTTO SOGLIA ❌)</li>
                <li>⚠️ <b>Risultato:</b> SEGNALE RIFIUTATO - condizioni non sufficienti</li>
                <li>📝 <b>Azione:</b> Attendere miglioramento confluenza o correlazione</li>
            </ul>
        </div>
    </div>
	
	


    <div class="indicator-info-box">
        <h2>Strategia "Multi-Confluence Ver. 9" (Advanced System) creata da gerardo_dorrico</h2>
        <p>Sistema avanzato che combina 6 categorie di indicatori con regressione lineare per segnali di alta qualità.</p>
        <p>Visita il mio profilo su TradingView per scoprire altri strumenti e strategie:</p>
        <a href="https://it.tradingview.com/u/gerardo_dorrico/" target="_blank" rel="noopener noreferrer" class="profile-link">
            Profilo TradingView di gerardo_dorrico
        </a>
        <p>Per visualizzare e aggiungere l'indicatore completo al tuo grafico su TradingView:</p>
        <a href="https://it.tradingview.com/script/faddeaSj/" target="_blank" rel="noopener noreferrer" class="indicator-button">
            Vedi l'indicatore su TradingView
        </a>
    </div>


<div class="indicator-info-box">
  <h2 style="margin-top:0;">Codice sorgente (Open Source)</h2>
  
  <p style="margin-top:18px; margin-bottom:10px;"><strong></strong></p>
  <div class="indicator-info-box" style="
  background: #181818;
  color: #e0e0e0;
  font-family: Fira Mono, Consolas, Menlo, Monaco, monospace;
  font-size: 13px;
  padding: 18px;
  border-radius: 8px;
  max-height: 620px;  /* altezza massima */
  overflow-y: auto;   /* scroll verticale */
  text-align: left;
  white-space: pre;   /* mantiene spazi e ritorni a capo */
  border: 1px solid #bbb;
  box-sizing: border-box;
">
// This Pine Script® code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © gerardo_dorrico

//@version=6
indicator('4H | Strategia Multi-Confluence Ver. 9', shorttitle = '4H | Strategia Multi Confluenza', overlay = true, max_labels_count = 500, max_lines_count = 500, max_bars_back = 500)

// ========== IMPOSTAZIONI ==========
// Impostazioni Regressione Lineare - PIÙ REATTIVA
lengthInput = input.int(50, title = 'LinReg Lunghezza', minval = 10, maxval = 200, group = 'Regressione Lineare')
sourceInput = input.source(close, title = 'Sorgente', group = 'Regressione Lineare')
linreg_sensitivity = input.float(0.8, title = 'Sensibilità Segnale LinReg', minval = 0.3, maxval = 1.0, step = 0.1, group = 'Regressione Lineare')

// Impostazioni Canale
group1 = 'Impostazioni Canale'
useUpperDevInput = input.bool(true, title = 'Deviazione Superiore', inline = 'Upper Deviation', group = group1)
upperMultInput = input.float(2.0, title = '', inline = 'Upper Deviation', group = group1)
useLowerDevInput = input.bool(true, title = '', inline = 'Lower Deviation', group = group1)
lowerMultInput = input.float(2.0, title = '', inline = 'Lower Deviation', group = group1)

// Impostazioni Visualizzazione
group2 = 'Impostazioni Visualizzazione'
showPearsonInput = input.bool(true, 'Mostra Pearson\'s R', group = group2)
showSignals = input.bool(true, 'Mostra Segnali di Trading', group = group2)
extendLeftInput = input.bool(false, 'Estendi Linee a Sinistra', group = group2)
extendRightInput = input.bool(true, 'Estendi Linee a Destra', group = group2)

// Impostazioni Segnale
group_signals = 'Impostazioni Segnale'
use_bb_filter = input.bool(true, 'Usa Filtro BB', group = group_signals)
use_pivot_filter = input.bool(true, 'Usa Filtro Pivot', group = group_signals)
use_stoch_rsi_filter = input.bool(true, 'Usa Filtro Stochastic RSI', group = group_signals)
use_ma_cross_filter = input.bool(true, 'Usa Filtro Incrocio Medie', group = group_signals)
use_momentum_filter = input.bool(true, 'Usa Filtro Momentum', group = group_signals)
use_price_action_filter = input.bool(true, 'Usa Filtro Price Action', group = group_signals)
min_pearson = input.float(0.5, 'Pearson R Minimo per Segnali', minval = 0.1, maxval = 1.0, step = 0.1, group = group_signals)

// Impostazioni Stochastic RSI
group_stoch = 'Impostazioni Stochastic RSI'
stoch_rsi_length = input.int(14, 'Lunghezza Stoch RSI', minval = 1, group = group_stoch)
stoch_rsi_rsi_length = input.int(14, 'Lunghezza RSI', minval = 1, group = group_stoch)
stoch_rsi_k = input.int(3, '%K Stoch Smoothing', minval = 1, maxval = 5, group = group_stoch)
stoch_rsi_d = input.int(3, '%D Stoch Smoothing', minval = 1, group = group_stoch)
stoch_oversold = input.float(20, 'Livello Ipervenduto', minval = 0, maxval = 50, group = group_stoch)
stoch_overbought = input.float(80, 'Livello Ipercomprato', minval = 50, maxval = 100, group = group_stoch)

// Impostazioni Medie Mobili
group_ma = 'Impostazioni Medie Mobili'
ema_length = input.int(21, 'Lunghezza EMA', minval = 1, group = group_ma)
sma_length = input.int(50, 'Lunghezza SMA', minval = 1, group = group_ma)
rsi_momentum_length = input.int(14, 'Lunghezza RSI Momentum', minval = 1, group = group_ma)
volume_avg_length = input.int(20, 'Lunghezza Media Volume', minval = 1, group = group_ma)

// Impostazioni Momentum - NUOVO
group_momentum = 'Impostazioni Momentum'
momentum_length = input.int(10, 'Lunghezza Momentum', minval = 1, group = group_momentum)
roc_length = input.int(12, 'Lunghezza Rate of Change', minval = 1, group = group_momentum)
williams_r_length = input.int(14, 'Lunghezza Williams %R', minval = 1, group = group_momentum)
cci_length = input.int(20, 'Lunghezza CCI', minval = 1, group = group_momentum)

// Impostazioni Price Action - NUOVO
group_pa = 'Impostazioni Price Action'
atr_length = input.int(14, 'Lunghezza ATR', minval = 1, group = group_pa)
engulfing_lookback = input.int(2, 'Lookback Pattern Engulfing', minval = 1, maxval = 5, group = group_pa)
doji_threshold = input.float(0.1, 'Soglia Doji (%)', minval = 0.01, maxval = 1.0, step = 0.01, group = group_pa)

// ========== INIZIALIZZA VARIABILI ==========
var float confluence_score = 0.0

// ========== STOCHASTIC RSI ==========
rsi_source = ta.rsi(close, stoch_rsi_rsi_length)
stoch_rsi = ta.stoch(rsi_source, rsi_source, rsi_source, stoch_rsi_length)
stoch_k = ta.sma(stoch_rsi, stoch_rsi_k)
stoch_d = ta.sma(stoch_k, stoch_rsi_d)

// ========== MEDIE MOBILI ==========
ema21 = ta.ema(close, ema_length)
sma50 = ta.sma(close, sma_length)
rsi_momentum = ta.rsi(close, rsi_momentum_length)
vol_avg = ta.sma(volume, volume_avg_length)

// Trend generale
trend_bullish = ema21 > sma50 and close > ema21
trend_bearish = ema21 < sma50 and close < ema21

// Plot delle medie mobili
plot(ema21, title = 'EMA 21', color = color.new(color.orange, 50), linewidth = 1)
plot(sma50, title = 'SMA 50', color = color.new(color.purple, 50), linewidth = 2)

// ========== INDICATORI MOMENTUM - NUOVO ==========
// Momentum
momentum = ta.mom(close, momentum_length)
momentum_normalized = momentum / close * 100

// Rate of Change
roc = ta.roc(close, roc_length)

// Williams %R
williams_r_highest = ta.highest(high, williams_r_length)
williams_r_lowest = ta.lowest(low, williams_r_length)
williams_r = williams_r_highest != williams_r_lowest ? -100 * (williams_r_highest - close) / (williams_r_highest - williams_r_lowest) : 0

// Commodity Channel Index
cci = ta.cci(hl2, cci_length)

// Momentum Score combinato
momentum_bullish = momentum_normalized > 0 and roc > 0 and williams_r > -50 and cci > 0
momentum_bearish = momentum_normalized < 0 and roc < 0 and williams_r < -50 and cci < 0

// ========== PRICE ACTION PATTERNS - NUOVO ==========
// ATR per volatilità
atr = ta.atr(atr_length)

// Body delle candele
body = math.abs(close - open)
body_pct = body / high - low * 100

// Doji Pattern
is_doji = body_pct <= doji_threshold

// Engulfing Patterns
bullish_engulfing = close > open and close[1] < open[1] and 
                   open <= close[1] and close >= open[1] and 
                   body > body[1] * 1.2

bearish_engulfing = close < open and close[1] > open[1] and 
                   open >= close[1] and close <= open[1] and 
                   body > body[1] * 1.2

// Hammer e Shooting Star
lower_shadow = open < close ? open - low : close - low
upper_shadow = open < close ? high - close : high - open
total_range = high - low

hammer = lower_shadow > body * 2 and upper_shadow < body * 0.5 and total_range > atr * 0.5
shooting_star = upper_shadow > body * 2 and lower_shadow < body * 0.5 and total_range > atr * 0.5

// Price Action Score
price_action_bullish = bullish_engulfing or (hammer and close > open)
price_action_bearish = bearish_engulfing or (shooting_star and close < open)

// ========== CALCOLO REGRESSIONE LINEARE - PIÙ REATTIVA ==========
calcSlope(source, length) =>
    max_bars_back(source, 5000)
    if not barstate.islast or length <= 1
        [float(na), float(na), float(na)]
    else
        sumX = 0.0
        sumY = 0.0
        sumXSqr = 0.0
        sumXY = 0.0
        for i = 0 to length - 1 by 1
            val = source[i]
            per = i + 1.0
            sumX := sumX + per
            sumY := sumY + val
            sumXSqr := sumXSqr + per * per
            sumXY := sumXY + val * per
        slope = (length * sumXY - sumX * sumY) / (length * sumXSqr - sumX * sumX)
        average = sumY / length
        intercept = average - slope * sumX / length + slope
        [slope, average, intercept]

[s, a, i] = calcSlope(sourceInput, lengthInput)
startPrice = i + s * (lengthInput - 1)
endPrice = i

// Define extend style and colors
extendStyle = extendRightInput ? extend.right : extendLeftInput ? extend.left : extend.none
colorUpper = color.new(color.blue, 80)
colorLower = color.new(color.red, 80)

var line baseLine = na
if na(baseLine) and not na(startPrice)
    baseLine := line.new(bar_index - lengthInput + 1, startPrice, bar_index, endPrice, width = 1, extend = extendStyle, color = color.new(colorLower, 0))
else
    line.set_xy1(baseLine, bar_index - lengthInput + 1, startPrice)
    line.set_xy2(baseLine, bar_index, endPrice)

calcDev(source, length, slope, average, intercept) =>
    upDev = 0.0
    dnDev = 0.0
    stdDevAcc = 0.0
    dsxx = 0.0
    dsyy = 0.0
    dsxy = 0.0
    periods = length - 1
    daY = intercept + slope * periods / 2
    val = intercept
    for j = 0 to periods by 1
        price = high[j] - val
        if price > upDev
            upDev := price
        price := val - low[j]
        if price > dnDev
            dnDev := price
        price := source[j]
        dxt = price - average
        dyt = val - daY
        price := price - val
        stdDevAcc := stdDevAcc + price * price
        dsxx := dsxx + dxt * dxt
        dsyy := dsyy + dyt * dyt
        dsxy := dsxy + dxt * dyt
        val := val + slope
    stdDev = math.sqrt(stdDevAcc / (periods == 0 ? 1 : periods))
    pearsonR = dsxx == 0 or dsyy == 0 ? 0 : dsxy / math.sqrt(dsxx * dsyy)
    [stdDev, pearsonR, upDev, dnDev]

[stdDev, pearsonR, upDev, dnDev] = calcDev(sourceInput, lengthInput, s, a, i)

// Calculate LinReg position (-1 to +1) - PIÙ SENSIBILE
linreg_position = not na(stdDev) and stdDev > 0 ? math.max(-1, math.min(1, (close - endPrice) / (stdDev * 1.5))) : 0

upperStartPrice = startPrice + (useUpperDevInput ? upperMultInput * stdDev : upDev)
upperEndPrice = endPrice + (useUpperDevInput ? upperMultInput * stdDev : upDev)
var line upper = na
lowerStartPrice = startPrice + (useLowerDevInput ? -lowerMultInput * stdDev : -dnDev)
lowerEndPrice = endPrice + (useLowerDevInput ? -lowerMultInput * stdDev : -dnDev)
var line lower = na

if na(upper) and not na(upperStartPrice)
    upper := line.new(bar_index - lengthInput + 1, upperStartPrice, bar_index, upperEndPrice, width = 1, extend = extendStyle, color = color.new(colorUpper, 0))
else
    line.set_xy1(upper, bar_index - lengthInput + 1, upperStartPrice)
    line.set_xy2(upper, bar_index, upperEndPrice)

if na(lower) and not na(lowerStartPrice)
    lower := line.new(bar_index - lengthInput + 1, lowerStartPrice, bar_index, lowerEndPrice, width = 1, extend = extendStyle, color = color.new(colorUpper, 0))
else
    line.set_xy1(lower, bar_index - lengthInput + 1, lowerStartPrice)
    line.set_xy2(lower, bar_index, lowerEndPrice)

linefill.new(upper, baseLine, color = colorUpper)
linefill.new(baseLine, lower, color = colorLower)

// ========== BANDE DI BOLLINGER ==========
bb_length = input.int(20, minval = 1, title = 'Lunghezza BB', group = 'Bande di Bollinger')
bb_maType = input.string('SMA', 'Tipo Media Mobile', options = ['SMA', 'EMA', 'SMMA (RMA)', 'WMA', 'VWMA'], group = 'Bande di Bollinger')
bb_src = input(close, title = 'Sorgente BB', group = 'Bande di Bollinger')
bb_mult = input.float(2.0, minval = 0.001, maxval = 50, title = 'Deviazione Std BB', group = 'Bande di Bollinger')

ma(source, length, _type) =>
    switch _type
        'SMA' => ta.sma(source, length)
        'EMA' => ta.ema(source, length)
        'SMMA (RMA)' => ta.rma(source, length)
        'WMA' => ta.wma(source, length)
        'VWMA' => ta.vwma(source, length)

bb_basis = ma(bb_src, bb_length, bb_maType)
bb_dev = bb_mult * ta.stdev(bb_src, bb_length)
bb_upper = bb_basis + bb_dev
bb_lower = bb_basis - bb_dev
bb_offset = input.int(0, 'Spostamento BB', minval = -500, maxval = 500, display = display.data_window, group = 'Bande di Bollinger')

// BB Position calculation
bb_position = (close - bb_lower) / (bb_upper - bb_lower) * 2 - 1 // -1 to +1 scale

plot(bb_basis, 'Base BB', color = #f0e0e0, offset = bb_offset)
bb_p1 = plot(bb_upper, 'Superiore BB', color = #cd5c5c, offset = bb_offset)
bb_p2 = plot(bb_lower, 'Inferiore BB', color = #7dcc5d, offset = bb_offset)

// ========== PUNTI PIVOT ==========
length = input(25, 'Lunghezza Pivot', group = 'Punti Pivot')
show_reg = input.bool(true, 'Pivot Regolari', inline = 'inline1', group = 'Punti Pivot')
reg_ph_css = input.color(#ef5350, 'Massimo', inline = 'inline1', group = 'Punti Pivot')
reg_pl_css = input.color(#26a69a, 'Minimo', inline = 'inline1', group = 'Punti Pivot')

ph = ta.pivothigh(length, length)
pl = ta.pivotlow(length, length)

// Track recent pivot levels
var float recent_ph = na
var float recent_pl = na
var int recent_ph_bar = na
var int recent_pl_bar = na

if bool(ph)
    recent_ph := ph
    recent_ph_bar := bar_index - length
if bool(pl)
    recent_pl := pl
    recent_pl_bar := bar_index - length

// ========== LOGICA SEGNALE AVANZATA ==========
// Passo 1: LinReg come filtro primario (più sensibile)
linreg_buy_primary = linreg_position <= -linreg_sensitivity
linreg_sell_primary = linreg_position >= linreg_sensitivity

// Passo 2: Calcolo confluence score
confluence_score := 0.0

// Con tributo BB
if use_bb_filter
    if bb_position <= -0.7
        confluence_score := confluence_score + 1
    else if bb_position >= 0.7
        confluence_score := confluence_score - 1

// Contributo Pivot
if use_pivot_filter and not na(recent_ph) and not na(recent_pl)
    distance_to_ph = math.abs(close - recent_ph) / recent_ph * 100
    distance_to_pl = math.abs(close - recent_pl) / recent_pl * 100

    if distance_to_pl < 3
        confluence_score := confluence_score + 1
    else if distance_to_ph < 3
        confluence_score := confluence_score - 1

// Contributo Stochastic RSI
if use_stoch_rsi_filter
    if stoch_k <= stoch_oversold and stoch_d <= stoch_oversold
        confluence_score := confluence_score + 1
    else if stoch_k >= stoch_overbought and stoch_d >= stoch_overbought
        confluence_score := confluence_score - 1

// Contributo Medie Mobili
if use_ma_cross_filter
    if trend_bullish and rsi_momentum > 50
        confluence_score := confluence_score + 0.5
    else if trend_bearish and rsi_momentum < 50
        confluence_score := confluence_score - 0.5

// Contributo Momentum - NUOVO
if use_momentum_filter
    if momentum_bullish
        confluence_score := confluence_score + 1
    else if momentum_bearish
        confluence_score := confluence_score - 1

// Contributo Price Action - NUOVO
if use_price_action_filter
    if price_action_bullish
        confluence_score := confluence_score + 1
    else if price_action_bearish
        confluence_score := confluence_score - 1

// Filtro Pearson R
pearson_ok = math.abs(pearsonR) >= min_pearson

// Segnali finali
buy_signal = linreg_buy_primary and confluence_score >= 1 and pearson_ok
sell_signal = linreg_sell_primary and confluence_score <= -1 and pearson_ok

// Calcolo Intensità Segnale
signal_strength = confluence_score + (linreg_buy_primary ? 1 : linreg_sell_primary ? -1 : 0)

// Plot segnali
if showSignals
    if buy_signal
        label.new(bar_index, low, 'BUY\n' + str.tostring(signal_strength, '#.#'), 
                 color = color.green, style = label.style_label_up, size = size.normal, 
                 tooltip = 'LinReg: ' + str.tostring(linreg_position, '#.##') + 
                          '\nBB: ' + str.tostring(bb_position, '#.##') + 
                          '\nStoch K: ' + str.tostring(stoch_k, '#.##') + 
                          '\nMomentum: ' + (momentum_bullish ? 'Rialzista' : 'Ribassista') + 
                          '\nPrice Action: ' + (price_action_bullish ? 'Rialzista' : 'Neutrale') + 
                          '\nPearson R: ' + str.tostring(pearsonR, '#.##'))

    if sell_signal
        label.new(bar_index, high, 'SELL\n' + str.tostring(signal_strength, '#.#'), 
                 color = color.red, style = label.style_label_down, size = size.normal, 
                 tooltip = 'LinReg: ' + str.tostring(linreg_position, '#.##') + 
                          '\nBB: ' + str.tostring(bb_position, '#.##') + 
                          '\nStoch K: ' + str.tostring(stoch_k, '#.##') + 
                          '\nMomentum: ' + (momentum_bearish ? 'Ribassista' : 'Rialzista') + 
                          '\nPrice Action: ' + (price_action_bearish ? 'Ribassista' : 'Neutrale') + 
                          '\nPearson R: ' + str.tostring(pearsonR, '#.##'))

// Visualizzazione Pearson's R
var label r = na
label.delete(r[1])
if showPearsonInput and not na(pearsonR)
    r_color = pearson_ok ? color.green : color.orange
    r := label.new(bar_index - lengthInput + 1, lowerStartPrice, 'R: ' + str.tostring(pearsonR, '#.####'), 
                  color = color.new(color.white, 100), textcolor = r_color, size = size.normal, style = label.style_label_up)

// ========== DASHBOARD AVANZATA ==========
if barstate.islast and showSignals
    var table info_table = table.new(position.bottom_right, 3, 13, bgcolor = color.new(color.black, 95), border_width = 1, border_color = color.new(color.gray, 60))

    // Header
    table.cell(info_table, 0, 0, '📊 4H | Strategia Multi Conf', text_color = color.white, bgcolor = color.new(color.blue, 85), text_size = size.small)
    table.merge_cells(info_table, 0, 0, 2, 0)

    // LinReg Position
    linreg_icon = linreg_buy_primary ? '🟢' : linreg_sell_primary ? '🔴' : '⚪'
    linreg_color = linreg_buy_primary ? color.new(color.lime, 60) : linreg_sell_primary ? color.new(color.red, 60) : color.new(color.gray, 80)
    linreg_text = linreg_buy_primary ? 'BUY' : linreg_sell_primary ? 'SELL' : 'NEU'

    table.cell(info_table, 0, 1, '🎯 LinReg', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 1, linreg_icon, text_color = color.white, bgcolor = linreg_color, text_size = size.large)
    table.cell(info_table, 2, 1, linreg_text + '\n' + str.tostring(linreg_position, '#.##'), text_color = color.white, bgcolor = linreg_color, text_size = size.small)

    // BB Position
    bb_icon = bb_position <= -0.7 ? '🟢' : bb_position >= 0.7 ? '🔴' : '⚪'
    bb_color = bb_position <= -0.7 ? color.new(color.lime, 75) : bb_position >= 0.7 ? color.new(color.red, 75) : color.new(color.yellow, 80)
    bb_text = bb_position <= -0.7 ? 'SOLD' : bb_position >= 0.7 ? 'BOUT' : 'NEU'

    table.cell(info_table, 0, 2, '📊 Bollinger', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 2, bb_icon, text_color = color.white, bgcolor = bb_color, text_size = size.large)
    table.cell(info_table, 2, 2, bb_text + '\n' + str.tostring(bb_position, '#.##'), text_color = color.white, bgcolor = bb_color, text_size = size.small)

    // Stochastic RSI
    stoch_icon = stoch_k <= stoch_oversold ? '🟢' : stoch_k >= stoch_overbought ? '🔴' : '⚪'
    stoch_color = stoch_k <= stoch_oversold ? color.new(color.lime, 75) : stoch_k >= stoch_overbought ? color.new(color.red, 75) : color.new(color.yellow, 80)
    stoch_text = stoch_k <= stoch_oversold ? 'SOLD' : stoch_k >= stoch_overbought ? 'BOUT' : 'NEU'

    table.cell(info_table, 0, 3, '⚡ Stoch RSI', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 3, stoch_icon, text_color = color.white, bgcolor = stoch_color, text_size = size.large)
    table.cell(info_table, 2, 3, stoch_text + '\nK:' + str.tostring(stoch_k, '#') + ' D:' + str.tostring(stoch_d, '#'), text_color = color.white, bgcolor = stoch_color, text_size = size.small)

    // Medie Mobili
    ma_icon = trend_bullish ? '📈' : trend_bearish ? '📉' : '↔️'
    ma_color = trend_bullish ? color.new(color.green, 80) : trend_bearish ? color.new(color.orange, 80) : color.new(color.gray, 80)
    ma_text = trend_bullish ? 'UP' : trend_bearish ? 'DOWN' : 'NEU'

    table.cell(info_table, 0, 4, '📈 Medie', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 4, ma_icon, text_color = color.white, bgcolor = ma_color, text_size = size.large)
    table.cell(info_table, 2, 4, ma_text + '\nRSI:' + str.tostring(rsi_momentum, '#'), text_color = color.white, bgcolor = ma_color, text_size = size.small)

    // Momentum - NUOVO
    momentum_icon = momentum_bullish ? '🚀' : momentum_bearish ? '⬇️' : '↔️'
    momentum_color = momentum_bullish ? color.new(color.lime, 70) : momentum_bearish ? color.new(color.red, 70) : color.new(color.gray, 80)
    momentum_text = momentum_bullish ? 'BULL' : momentum_bearish ? 'BEAR' : 'NEU'

    table.cell(info_table, 0, 5, '🚀 Momentum', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 5, momentum_icon, text_color = color.white, bgcolor = momentum_color, text_size = size.large)
    table.cell(info_table, 2, 5, momentum_text + '\nROC:' + str.tostring(roc, '#.#'), text_color = color.white, bgcolor = momentum_color, text_size = size.small)

    // Price Action - NUOVO
    pa_icon = price_action_bullish ? '🟢' : price_action_bearish ? '🔴' : '⚪'
    pa_color = price_action_bullish ? color.new(color.lime, 70) : price_action_bearish ? color.new(color.red, 70) : color.new(color.gray, 80)
    pa_text = price_action_bullish ? 'BULL' : price_action_bearish ? 'BEAR' : 'NEU'

    table.cell(info_table, 0, 6, '🕯️ Price Action', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 6, pa_icon, text_color = color.white, bgcolor = pa_color, text_size = size.large)
    table.cell(info_table, 2, 6, pa_text + '\nATR:' + str.tostring(atr, '#.##'), text_color = color.white, bgcolor = pa_color, text_size = size.small)

    // Pivot Points
    pivot_icon = not na(recent_ph) and not na(recent_pl) ? (math.abs(close - recent_pl) < math.abs(close - recent_ph) ? '🟢' : '🔴') : '⚪'
    pivot_color = not na(recent_ph) and not na(recent_pl) ? (math.abs(close - recent_pl) < math.abs(close - recent_ph) ? color.new(color.lime, 75) : color.new(color.red, 75)) : color.new(color.gray, 80)
    pivot_text = not na(recent_ph) and not na(recent_pl) ? (math.abs(close - recent_pl) < math.abs(close - recent_ph) ? 'SUP' : 'RES') : 'N/A'

    table.cell(info_table, 0, 7, '📍 Pivot', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 7, pivot_icon, text_color = color.white, bgcolor = pivot_color, text_size = size.large)
    table.cell(info_table, 2, 7, pivot_text + '\n' + (not na(recent_pl) ? str.tostring(recent_pl, '#.##') : 'N/A'), text_color = color.white, bgcolor = pivot_color, text_size = size.small)

    // Pearson R
    pearson_icon = pearson_ok ? (pearsonR > 0 ? '📈' : '📉') : '⚠️'
    pearson_color = pearson_ok ? (pearsonR > 0 ? color.new(color.green, 70) : color.new(color.orange, 70)) : color.new(color.yellow, 80)
    pearson_text = pearson_ok ? 'OK' : 'WEAK'

    table.cell(info_table, 0, 8, '📊 Pearson R', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 8, pearson_icon, text_color = color.white, bgcolor = pearson_color, text_size = size.large)
    table.cell(info_table, 2, 8, pearson_text + '\n' + str.tostring(pearsonR, '#.###'), text_color = color.white, bgcolor = pearson_color, text_size = size.small)

    // Confluence Score
    confluence_icon = confluence_score >= 2 ? '🚀' : confluence_score <= -2 ? '⬇️' : confluence_score > 0 ? '📈' : confluence_score < 0 ? '📉' : '➖'
    confluence_color = confluence_score >= 2 ? color.new(color.lime, 60) : confluence_score <= -2 ? color.new(color.red, 60) : confluence_score > 0 ? color.new(color.green, 75) : confluence_score < 0 ? color.new(color.orange, 75) : color.new(color.gray, 80)
    confluence_text = confluence_score >= 2 ? 'STRONG' : confluence_score <= -2 ? 'STRONG' : confluence_score > 0 ? 'BULL' : confluence_score < 0 ? 'BEAR' : 'NEUTRAL'

    table.cell(info_table, 0, 9, '⚡ Confluence', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 9, confluence_icon, text_color = color.white, bgcolor = confluence_color, text_size = size.large)
    table.cell(info_table, 2, 9, confluence_text + '\n' + str.tostring(confluence_score, '#.#'), text_color = color.white, bgcolor = confluence_color, text_size = size.small)

    // Signal Strength
    signal_icon = buy_signal ? '🟢 BUY' : sell_signal ? '🔴 SELL' : '⚪ WAIT'
    signal_color = buy_signal ? color.new(color.lime, 50) : sell_signal ? color.new(color.red, 50) : color.new(color.gray, 80)
    signal_text = buy_signal ? 'BUY' : sell_signal ? 'SELL' : 'WAIT'

    table.cell(info_table, 0, 10, '🎯 SEGNALE', text_color = color.white, bgcolor = color.new(color.blue, 75), text_size = size.small)
    table.merge_cells(info_table, 0, 10, 2, 10)

    table.cell(info_table, 0, 11, signal_icon, text_color = color.white, bgcolor = signal_color, text_size = size.normal)
    table.merge_cells(info_table, 0, 11, 2, 11)

    // Volume Analysis
    volume_ratio = volume > vol_avg ? volume / vol_avg : vol_avg > 0 ? volume / vol_avg : 1
    volume_icon = volume_ratio > 1.5 ? '🔊' : volume_ratio > 1.2 ? '🔉' : '🔈'
    volume_color = volume_ratio > 1.5 ? color.new(color.lime, 70) : volume_ratio > 1.2 ? color.new(color.yellow, 70) : color.new(color.gray, 80)
    volume_text = volume_ratio > 1.5 ? 'HIGH' : volume_ratio > 1.2 ? 'MED' : 'LOW'

    table.cell(info_table, 0, 12, '🔊 Volume', text_color = color.white, bgcolor = color.new(color.gray, 85), text_size = size.small)
    table.cell(info_table, 1, 12, volume_icon, text_color = color.white, bgcolor = volume_color, text_size = size.large)
    table.cell(info_table, 2, 12, volume_text + '\n' + str.tostring(volume_ratio, '#.#') + 'x', text_color = color.white, bgcolor = volume_color, text_size = size.small)

// ========== ALERT CONDITIONS ==========
// Alert per segnali di trading
alertcondition(buy_signal, title = 'BUY Signal', message = 'Segnale BUY - Confluence Score: {{plot("confluence_score")}} - LinReg: {{plot("linreg_position")}} - Pearson R: {{plot("pearsonR")}}')
alertcondition(sell_signal, title = 'SELL Signal', message = 'Segnale SELL - Confluence Score: {{plot("confluence_score")}} - LinReg: {{plot("linreg_position")}} - Pearson R: {{plot("pearsonR")}}')

// Alert per cambi di trend
trend_change_bullish = trend_bullish and not trend_bullish[1]
trend_change_bearish = trend_bearish and not trend_bearish[1]

alertcondition(trend_change_bullish, title = 'Trend Change - Bullish', message = 'Cambio trend: RIALZISTA - EMA21 > SMA50 e prezzo > EMA21')
alertcondition(trend_change_bearish, title = 'Trend Change - Bearish', message = 'Cambio trend: RIBASSISTA - EMA21 < SMA50 e prezzo < EMA21')

// Alert per livelli estremi
extreme_oversold = bb_position <= -0.9 and stoch_k <= 10 and linreg_position <= -0.8
extreme_overbought = bb_position >= 0.9 and stoch_k >= 90 and linreg_position >= 0.8

alertcondition(extreme_oversold, title = 'Extreme Oversold', message = 'LIVELLO ESTREMO: Ipervenduto - BB: {{plot("bb_position")}} - Stoch: {{plot("stoch_k")}} - LinReg: {{plot("linreg_position")}}')
alertcondition(extreme_overbought, title = 'Extreme Overbought', message = 'LIVELLO ESTREMO: Ipercomprato - BB: {{plot("bb_position")}} - Stoch: {{plot("stoch_k")}} - LinReg: {{plot("linreg_position")}}')

// ========== PLOT INVISIBILI PER ALERT ==========
plot(confluence_score, title = 'Confluence Score', display = display.none)
plot(linreg_position, title = 'LinReg Position', display = display.none)
plot(bb_position, title = 'BB Position', display = display.none)
plot(stoch_k, title = 'Stoch K', display = display.none)
plot(pearsonR, title = 'Pearson R', display = display.none)

// ========== BACKGROUND COLORING ==========
// Colore di sfondo basato sul segnale principale
bg_color = buy_signal ? color.new(color.green, 97) : sell_signal ? color.new(color.red, 97) : na
bgcolor(bg_color, title = 'Background Signal')

// Colore aggiuntivo per confluence forte
strong_confluence_bg = confluence_score >= 3 ? color.new(color.lime, 98) : confluence_score <= -3 ? color.new(color.red, 98) : na
bgcolor(strong_confluence_bg, title = 'Strong Confluence Background')

// ========== STATISTICHE SEGNALI ==========
// Contatori per performance tracking
var int total_buy_signals = 0
var int total_sell_signals = 0
var int strong_buy_signals = 0
var int strong_sell_signals = 0

if buy_signal
    total_buy_signals += 1
    if signal_strength >= 3
        strong_buy_signals += 1

if sell_signal
    total_sell_signals += 1
    if signal_strength <= -3
        strong_sell_signals += 1

// Plot delle statistiche (invisibili, solo per reference)
plot(total_buy_signals, title = 'Total Buy Signals', display = display.none)
plot(total_sell_signals, title = 'Total Sell Signals', display = display.none)
plot(strong_buy_signals, title = 'Strong Buy Signals', display = display.none)
plot(strong_sell_signals, title = 'Strong Sell Signals', display = display.none)
</div>


  <div style="margin-top:16px;">
    <a href="https://beneinst.github.io/tradingspot/Multi-Confluence-Ver9.pine" 
       download="Multi-Confluence-Ver9.pine" 
       style="display:inline-block; background:#0057b8; color:#fff; padding:10px 22px; border-radius:6px; text-decoration:none; font-weight:600; margin-right:10px;">
      ⬇️ Download Pine Script
    </a>
    <a style="display:inline-block; background:#222; color:#fff; padding:10px 22px; border-radius:6px; text-decoration:none;">
      Scarica il Pine Script completo per TradingView.
    </a>
  </div>
</div>
<div class="footer">
    Trading Spot Manager v1.1 | 
    <a href="index.html">Operatività</a> | 
    <a href="panoramica-capitale.html">Capitale</a> | 
    <a href="blocco-note.html">Note</a> | 
    <a href="Strategia-Trading.html">Indicatore</a> | 
    <a href="candlestick.html">Candlestick</a> | 
    <a href="cheat-sheet.html">Patterns</a>
</div>

</body>
</html>
				
				
				
				
